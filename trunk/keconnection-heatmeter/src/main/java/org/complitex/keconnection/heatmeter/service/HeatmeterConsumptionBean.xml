<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.complitex.keconnection.heatmeter.service.HeatmeterConsumptionBean">
    <resultMap id="heatmeterConsumptionResultMap" type="org.complitex.keconnection.heatmeter.entity.HeatmeterConsumption">
        <id property="id"/>
        <result property="heatmeterId"/>
        <result property="readoutDate"/>
        <result property="om"/>
        <result property="consumption"/>
        <result property="consumption1"/>
        <result property="consumption2"/>
        <result property="consumption3"/>
        <result property="status"/>
    </resultMap>

    <insert id="insertHeatmeterConsumption" parameterType="org.complitex.keconnection.heatmeter.entity.HeatmeterConsumption">
        insert into `heatmeter_consumption` (`heatmeter_id`, `readout_date`, `operating_month`, `consumption`,
                                             `consumption1`, `consumption2`, `consumption3`, `status`)
            values (#{heatmeterId}, #{readoutDate}, #{om}, #{consumption}, #{consumption1}, #{consumption2},
                    #{consumption3}, #{status})
    </insert>

    <update id="updateHeatmeterConsumption" parameterType="org.complitex.keconnection.heatmeter.entity.HeatmeterConsumption">
        update `heatmeter_consumption` set  `readout_date` = #{readoutDate}, `operating_month` = #{om},
            `consumption` = #{consumption}, `consumption1` = #{consumption1}, `consumption2` = #{consumption2},
            `consumption3` = #{consumption3}, `status` = #{status}
    </update>

    <delete id="deleteHeatmeterConsumption" parameterType="long">
        delete from `heatmeter_consumption` where `id` = #{id}
    </delete>

    <select id="selectHeatmeterConsumptionsByHeatmeterId" parameterType="long" resultMap="heatmeterConsumptionResultMap">
        select * from `heatmeter_consumption` where `heatmeter_id` = #{heatmeterId}
    </select>
    
    <select id="selectMaxHeatmeterConsumption" parameterType="long" resultMap="heatmeterConsumptionResultMap">
        SELECT * FROM `heatmeter_consumption` WHERE `heatmeter_id` = #{heatmeterId} AND `readout_date` = 
            (SELECT MAX(c.`readout_date`) FROM `heatmeter_consumption` c WHERE c.`heatmeter_id` = #{heatmeterId})
    </select>

</mapper>